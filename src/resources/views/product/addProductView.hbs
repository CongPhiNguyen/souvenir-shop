<title>Product</title>
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
<link rel="stylesheet" href="../css/product.css">

<div class="wrapper">
    <div class="container">
        <div class="fast-navbar">
            <div class="fast-navbar-item" onclick="clickFastNavbar('Fire')">
                <i class="fas fa-fire"></i>
            </div>
            <div class="fast-navbar-item">
                <i class="fas fa-compass"></i>
            </div>
            <div class="fast-navbar-item">
                <i class="fas fa-clock"></i>
            </div>
            <div class="fast-navbar-item">
                <i class="fas fa-envelope"></i>
            </div>
            <div class="fast-navbar-item">
                <i class="fas fa-bars"></i>    
            </div>
        </div>
        {{!-- <a class="add-product-button" href="#">Add product</a> --}}
        {{!-- Phần breadscrum --}}
        <div class="breadscrum">
            <ol class='breadscrum-list'>    
                <li class='breadscrum-item'>
                    <a href="/home">
                        <span>Home</span>
                    </a>
                </li>
                >>
                <li class='breadscrum-item'>
                    <a href="/home/figure">
                        <span>Figure</span>
                    </a>
                </li>
                >>
                <li class='breadscrum-item'>
                    <a href="/home/figure/Stein;Gate">
                        <span>Stein;Gate</span>
                    </a>
                </li>
            </ol>
        </div>
        {{!-- Phần của product --}}
        <div class="product-container row">
            <div class="product-image col-md-4">
                <label class="add-image-label" for='avatar'>
                    <img class="product-current-upload-img" 
                     src="http://res.cloudinary.com/phiroud321/image/upload/v1639138454/add-2935429_960_720_xc31ip.png" 
                     alt="">  
                </label>
                <input type="file" id="avatar" name="avatar" accept="image/png, image/jpeg" style='display: none'>
            </div>
            <div class="product-info col-md-8">
                <input type="text" class="product-name" name="productName"></input>
                <div class="product-place">
                    <i class="fas fa-map-marker-alt"></i>
                    <input class="product-location" name="location"></input>
                </div>
                <div class="product-price-sale">
                    <input class="product-import-price col-12" name="importPrice" placeholder="import price"></input>
                    <input class="product-old-price col-12" name="sellPrice" placeholder="sell price"></input>
                    <input class="product-price col-12" name="currentPrice" placeholder="current price"></input>
                    {{!-- <div class="sale-percent">7%</div> --}}
                </div>
                <input type='text' class="product-description" name="description" placeholder="Description"> </input>
                <div class="product-sold"   >
                    <div class="sold-title">Đã bán: </div>
                    <div class="sold-num">...</div>
                </div>
                <div class="product-rating-average">
                    <i class="product-rating-icon fas fa-star"></i>
                    <i class="product-rating-icon fas fa-star"></i>
                    <i class="product-rating-icon fas fa-star"></i>
                    <i class="product-rating-icon fas fa-star"></i>
                    <i class="product-rating-icon fas fa-star"></i>
                </div>
                <div class="quantity-choose">
                    <div class="quantity-chose-title">Chọn số lượng mua</div>
                    <div class="input-group bootstrap-touchspin">
                        <span class="input-group-addon bootstrap-touchspin-prefix" style="display: none;"></span>
                        <input type="number" name="productQuantity" class="input-group form-control" min="1" aria-label="Quantity" style="display: block;" placeholder="Import quantity">
                        <span class="input-group-addon bootstrap-touchspin-postfix" style="display: none;"></span><span class="input-group-btn-vertical">
                        
                        <button class="btn btn-touchspin js-touchspin bootstrap-touchspin-up" type="button">
                            <i class="material-icons touchspin-up"></i>
                        </button><button class="btn btn-touchspin js-touchspin bootstrap-touchspin-down" type="button">
                            <i class="material-icons touchspin-down"></i>
                        </button></span></div>
                </div>
                <div class="buy-container">
                    {{!-- <button class="add-to-cart bt-add-to-cart" onclick="addToCart()">
                        Add to cart 
                    </button> --}}
                    <button class="add-to-cart bt-add-to-cart" onclick="addProduct()">
                        Add product 
                    </button>
                    {{!-- <button class="buy-now">
                        Buy now
                    </button> --}}
                </div>
                
            </div>

        </div>  
        <div class="product-detail-container">
            <div class="detail-title">
                Product Description
            </div>
            <div class="bread-scrum-detail content-container">
                <div class="title">BreadScrum</div>
                <div class="content">Morri Shop >> Figure >> Stern; Gate</div>         
            </div>
            <div class="origin-detail content-container">
                <div class="title">Source</div>
                <div class="content">Akihabara, Japan</div>    
            </div>
            <div class="remain-num content-container">
                <div class="title">Remain</div>
                <div class="content">4</div>    
            </div>
            <div class="detail-description">
                From Max Factory/Good Smile Company. A rerelease?. This must also be the choice of Steins; Gate. From the sci-fi adventure series Steins; Gate comes a rerelease of the young genius, figma Kurisu Makise. Using the smooth yet posable joints of figma and the included articulated figma stand, you can act out a variety of different scenes. She comes with three expressions: a standard face, an angry face and a smirking face to show all sides of her tsundere personality. Extra arm parts are included to recreate her classic "folded arm" pose. Mirai Gadget #6: "Cyalume Saber" is also included. Plus, a total of 12 extra hand parts are included, including hands that allow her to hold important items from the game, such as her cellphone and a drink bottle.
            </div>
        </div>
        <div class="blog-container">
            <div class="blog-title">
                Source place
            </div>
            <div class="blog-desc">
                Akihabara (秋葉原), also called Akiba after a former local shrine, is a district in central Tokyo that is famous for its many electronics shops. In more recent years, Akihabara has gained recognition as the center of Japan's otaku (diehard fan) culture, and many shops and establishments devoted to anime and manga are now dispersed among the electronic stores in the district. On Sundays, Chuo Dori, the main street through the district, is closed to car traffic from 13:00 to 18:00 (until 17:00 from October through March).
                Akihabara has been undergoing major redevelopment over the years, including the renovation and expansion of Akihabara Station and the construction of new buildings in its proximity. Among these newly opened buildings were a huge Yodobashi electronics store and the Akihabara Crossfield, a business complex with the aim of promoting Akihabara as a center for global electronics technology and trade.
            </div>
        </div>
    </div>
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    var currentLink = '';
    //{{!-- const dropdownStatusButton = document.querySelector('.btn-dropdown-status'); --}}
    function clickFastNavbar(message) {
        alert(message);
    };

    function uploadPicture() 
    {
        var fileName = document.getElementById('avatar').files[0];
        console.log(fileName);
        const formData = new FormData();
        formData.append("file", fileName)
        formData.append("upload_preset", "phiroud");
        axios.post(`https://api.cloudinary.com/v1_1/phiroud321/image/upload`, formData)
            .then(res => {
                console.log("link", res.data.url);
                currentLink = res.data.url;
            })
            .catch(err => {
                console.log("Thất bại");
            })
    }

    document.querySelector('#avatar').onchange = function(evt) {
        console.log('Nhận sự kiện click add hình rồi')
        var tgt = evt.target || window.event.srcElement,
        files = tgt.files;

        // FileReader support
        if (FileReader && files && files.length) {
            var fr = new FileReader();
            fr.onload = function () {
                document.querySelector('.product-current-upload-img').src = fr.result;
            }
            fr.readAsDataURL(files[0]);
            uploadPicture();
        }
    }

    //{{!-- const addCartButton = document.querySelector('.btn-add-to-cart'); --}}
    async function addProduct() {
        {{!-- alert('Đang chạy axios') --}}
        var resultProduct;
        //GenID by last productID +1
        await axios.get(`http://localhost:3000/product/get-product`, {
            params: {filter:{}}
        })
        .then(res => {
            resultProduct = res.data.data;
        })
        .catch(err => {
            alert(err)
            console.log(err)
            return;
        })
        var productIDGen = parseInt(resultProduct[resultProduct.length - 1].productID) + 1;
        try{
            const data = { 
                productID: productIDGen, 
                name: document.querySelector('input[name="productName"').value, 
                location: document.querySelector('input[name="location"').value, 
                province: document.querySelector('input[name="location"').value, 
                quantity: document.querySelector('input[name="productQuantity"').value, 
                remain: document.querySelector('input[name="productQuantity"').value,
                originalPrice:  document.querySelector('input[name="importPrice"').value,
                sellPrice:  document.querySelector('input[name="sellPrice"').value,
                currentPrice:  document.querySelector('input[name="currentPrice"').value,
                imgUrl: currentLink,
                description: document.querySelector('input[name="description"').value,
            };
            console.log("data", data);
            await axios.post(`http://localhost:3000/product/add-product`, data)
            .then(res => {
                console.log("Save success");
                alert("Lưu thành công")
            })
            .catch(err => {
                alert(err);
                if(err.response.data.message)
                {
                    alert(err.response.data.message);
                }
                console.log(err);
                isAddOK = false;
            })
        }
        catch(e)
        {
            alert(e);
        }
    };
</script>

